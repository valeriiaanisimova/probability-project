<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сравнение жизненных сценариев</title>
    <style>
        :root {
            --text: #e4e3fc;
            --background: #010109;
            --primary: #8e83f2;
            --secondary: #650f92;
            --accent: #c33eeb;
            --dark: #0a081a;
            --darker: #050313;
            --light: #e4e3fc;
            --lighter: #f5f4fe;
            --gray: #252535;
            --success: #5db5f6;
            --danger: #f0503f;
            --warning: #fd7e14;
            --card-bg: #121222;
            --text-muted: #9a99b8;
            --bad-value: #ff6b8b;
            /* розовый для ошибок по умолчанию */
            --good-value: #6ddea7;
            /* мятный для успеха по умолчанию */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
            padding: 0px;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
        }

        th {
            text-align: left;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: var(--darker);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 800;
            letter-spacing: -0.5px;
            transition: all 0.3s;
        }

        .subtitle {
            font-size: 1.2rem;
            color: var(--text-muted);
            max-width: 700px;
            margin: 0 auto;
            transition: all 0.3s;
        }

        .section-title {
            font-size: 1.8rem;
            margin-bottom: 30px;
            text-align: center;
            color: var(--primary);
            font-weight: 700;
            position: relative;
            display: inline-block;
            padding-bottom: 10px;
            transition: all 0.3s;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 450px;
            height: 3px;
            background: linear-gradient(to right, var(--primary), var(--accent));
            border-radius: 3px;
            transition: all 0.3s;
        }

        .scenario-description {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .scenario-card {
            flex: 1;
            padding: 25px;
            border-radius: 12px;
            background: var(--card-bg);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border-top: 4px solid;
            transition: all 0.3s;
        }

        .current-card {
            border-color: var(--warning);
        }

        .it-card {
            border-color: var(--success);
        }

        .scenario-title {
            font-size: 1.4rem;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .current-title {
            color: var(--warning);
        }

        .it-title {
            color: var(--success);
        }

        .scenario-conditions {
            margin-top: 15px;
        }

        .scenario-conditions h4 {
            margin-bottom: 10px;
            color: var(--text-muted);
        }

        .scenario-conditions ul {
            padding-left: 20px;
        }

        .scenario-conditions li {
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 30px 0;
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 15px;
            text-align: center;
            border: 1px solid var(--gray);
            transition: all 0.3s;
        }

        .comparison-table th {
            background-color: rgba(142, 131, 242, 0.1);
            color: var(--primary);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        .comparison-table tr:nth-child(even) {
            background-color: rgba(255, 255, 255, 0.03);
        }

        .probability-value {
            font-size: 1.2rem;
            font-weight: 700;
            margin: 5px 0;
        }

        .bad-value {
            color: var(--bad-value);
            /* Теперь использует переменную из темы */
            padding: 5px 10px;
            border-radius: 5px;
            text-align: center;
        }

        .good-value {
            color: var(--good-value);
            /* Теперь использует переменную из темы */
            padding: 5px 10px;
            border-radius: 5px;
            text-align: center;
        }

        .details-btn {
            background: rgba(142, 131, 242, 0.2);
            color: var(--primary);
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .details-btn:hover {
            background: rgba(142, 131, 242, 0.4);
        }

        .modal {
            display: none;
            /* По умолчанию скрыто */
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(1, 1, 9, 0.9);
            /* Центрирование содержимого */
            justify-content: center;
            align-items: center;
            overflow: auto;
            /* Прокрутка всей страницы, если нужно */
        }

        .modal-content {
            background-color: var(--darker);
            padding: 30px;
            border: 1px solid var(--primary);
            border-radius: 12px;
            width: 80%;
            max-width: 1000px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            /* Ограничение по высоте с прокруткой */
            max-height: 90vh;
            overflow-y: auto;
            /* Прокрутка внутри окна */
            margin: 40px auto;
            /* Отступ сверху и центрирование */
            transition: all 0.3s;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--gray);
            top: 0;
            background-color: var(--darker);
            z-index: 10;
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--primary);
            font-weight: 700;
        }

        .close {
            color: var(--text-muted);
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: var(--light);
        }

        .calculation-steps {
            margin-top: 20px;
        }

        .calculation-step {
            margin-bottom: 15px;
        }

        .calculation-formula {
            background: var(--gray);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            border-left: 3px solid var(--primary);
        }

        .parameter-controls {
            padding: 20px;
            background: var(--card-bg);
            border-radius: 8px;
        }

        .parameter-group {
            margin-bottom: 20px;
        }

        .parameter-group h3 {
            margin-bottom: 15px;
            color: var(--primary);
        }

        .parameter-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .parameter-label {
            width: 250px;
            font-size: 0.9rem;
        }

        .parameter-value {
            flex: 1;
        }

        input[type="number"],
        input[type="range"],
        select {
            width: 100%;
            padding: 8px;
            background: var(--gray);
            border: 1px solid var(--text-muted);
            border-radius: 4px;
            color: var(--light);
        }

        input[type="range"] {
            padding: 0;
        }

        .update-btn {
            background: var(--primary);
            color: var(--background);
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .update-btn:hover {
            background: var(--accent);
        }

        .params-btn {
            background: var(--primary);
            color: var(--background);
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 20px auto;
            display: block;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .params-btn:hover {
            background: var(--accent);
        }

        footer {
            text-align: center;
            padding: 30px;
            margin-top: 60px;
            color: var(--text-muted);
            font-size: 0.9rem;
            border-top: 1px solid var(--gray);
        }

        .theme-palette {
            position: fixed;
            bottom: 30px;
            right: 50px;
            z-index: 99;
        }

        .palette-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            transition: all 0.3s;
            position: relative;
            z-index: 101;
        }

        .palette-button:hover {
            transform: scale(1.1);
        }

        .color-options {
            position: absolute;
            bottom: 0px;
            right: -120px;
            display: none;
            background: transparent;
            padding: 0;
            border-radius: 50%;
            width: 300px;
            height: 200px;
            transform-origin: center;
            z-index: 100;
            overflow: hidden;
        }

        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
            position: absolute;
            top: 50%;
            /* Центр по вертикали */
            left: 50%;
            /* Центр по горизонтали */
            transform-origin: 0 75px;
            /* Центр вращения для полукруга */
        }

        .color-option:hover {
            transform: translate(-50%, -50%) scale(1.2) rotate(0deg);
            /* Увеличение при наведении */
        }

        .color-option.active {
            border-color: var(--light);
        }

        /* Распределение кнопок по полукругу */
        .color-option:nth-child(1) {
            transform: rotate(-90deg) translateX(-50%);
        }

        .color-option:nth-child(2) {
            transform: rotate(-60deg) translateX(-50%);
        }

        .color-option:nth-child(3) {
            transform: rotate(-30deg) translateX(-50%);
        }

        .color-option:nth-child(4) {
            transform: rotate(0deg) translateX(-50%);
        }

        .color-option:nth-child(5) {
            transform: rotate(30deg) translateX(-50%);
        }

        .color-option:nth-child(6) {
            transform: rotate(60deg) translateX(-50%);
        }

        /* Включение отображения полукруга */
        .color-options.show {
            display: flex;
        }


        .color-customizer {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(1, 1, 9, 0.9);
            justify-content: center;
            align-items: center;
            overflow: auto;
        }

        .color-customizer-content {
            background-color: var(--darker);
            padding: 30px;
            border: 1px solid var(--primary);
            border-radius: 12px;
            width: 80%;
            max-width: 500px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            max-height: 90vh;
            overflow-y: auto;
            margin: 40px auto;
            transition: all 0.3s;
        }

        .color-customizer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--gray);
        }

        .color-customizer-title {
            font-size: 1.5rem;
            color: var(--primary);
            font-weight: 700;
        }

        .color-customizer-close {
            color: var(--text-muted);
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .color-customizer-close:hover {
            color: var(--light);
        }

        .color-picker-group {
            margin-bottom: 20px;
        }

        .color-picker-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text);
            font-size: 0.95rem;
        }

        .color-picker {
            width: 100%;
            height: 40px;
            border-radius: 5px;
            cursor: pointer;
            background: var(--gray);
            border: 1px solid var(--text-muted);
        }

        .customizer-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        .customizer-btn {
            padding: 10px 20px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .apply-btn {
            background: var(--primary);
            color: var(--background);
        }

        .apply-btn:hover {
            background: var(--accent);
        }

        .cancel-btn {
            background: var(--gray);
            color: var(--text);
            border: 1px solid var(--text-muted);
        }

        .cancel-btn:hover {
            background: var(--secondary);
            color: var(--light);
        }

        @media (max-width: 768px) {
            .scenario-description {
                flex-direction: column;
            }

            h1 {
                font-size: 2.2rem;
            }

            .modal-content {
                width: 95%;
                margin: 10% auto;
            }

            .parameter-row {
                flex-direction: column;
                align-items: flex-start;
            }

            .parameter-label {
                width: 100%;
                margin-bottom: 5px;
            }

            .theme-palette {
                bottom: 20px;
                right: 20px;
            }

            .palette-button {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }
        }

        /* Для темы темного фона (фиолетовая) */
        .theme-dark {
            --primary: #8e83f2;
            --accent: #c33eeb;
            --background: #010109;
            --text: #e4e3fc;
            --card-bg: #121222;
            --bad-value: #ff6b8b;
            /* розовый для ошибок */
            --good-value: #6ddea7;
            /* мятный для успеха */
        }

        /* Для синей темы */
        .theme-blue {
            --primary: #5db5f6;
            --accent: #3d8bfd;
            --background: #00121a;
            --text: #dceefc;
            --card-bg: #0a1c2a;
            --bad-value: #ff9b5c;
            /* персиковый */
            --good-value: #5cd6b4;
            /* бирюзовый */
        }

        /* Для красной темы */
        .theme-red {
            --primary: #ff6b6b;
            --accent: #ff8e8e;
            --background: #1a0000;
            --text: #ffdfdf;
            --card-bg: #2a0000;
            --bad-value: #ff9b5c;
            /* персиковый */
            --good-value: #a8e6a0;
            /* светло-зеленый */
        }

        /* Для зеленой темы */
        .theme-green {
            --primary: #60d394;
            --accent: #3acf7a;
            --background: #002a1e;
            --text: #dcfcee;
            --card-bg: #0a3326;
            --bad-value: #ff8a65;
            /* коралловый */
            --good-value: #3fb1b0;
            /* бирюзовый */
        }

        /* Для фиолетовой темы */
        .theme-yellow {
            --primary: #ffd700;
            /* Ярко-золотой (основной) */
            --accent: #f2a900;
            /* Теплый янтарный */
            --background: #121212;
            /* Темно-серый, почти черный */
            --text: #fffbea;
            /* Мягкий кремово-белый */
            --card-bg: #1e1e1e;
            /* Темно-серый для карточек */
            --bad-value: #ff7b42;
            /* Ярко-красный для ошибок */
            --good-value: #a1d743;
            /* Лаймово-зеленый для успеха */
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="container">
        <header>
            <h1>Сравнение жизненных сценариев</h1>
            <p class="subtitle">Вероятности быть здоровой, богатой и счастливой в разных условиях (2025-2040)</p>
        </header>

        <button class="params-btn" onclick="openModal('parameters-modal')">Изменить параметры моделирования</button>

        <table class="comparison-table">
            <thead>
                <tr>
                    <th>Критерий</th>
                    <th>Твоя жизнь сейчас</th>
                    <th>Фронтенд-разработчик </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Финансы ($1M)</strong><br>Вероятность накопить $1 млн к 2040 году</td>
                    <td>
                        <div class="probability-value bad-value" id="current-money">0%</div>
                        <button class="details-btn" onclick="openModal('money-current')">Подробный расчет</button>
                    </td>
                    <td>
                        <div class="probability-value good-value" id="it-money">86.7%</div>
                        <button class="details-btn" onclick="openModal('money-it')">Подробный расчет</button>
                    </td>
                </tr>
                <tr>
                    <td><strong>Здоровье</strong><br>Вероятность сохранить относительное здоровье</td>
                    <td>
                        <div class="probability-value bad-value" id="current-health">0.000107%</div>
                        <button class="details-btn" onclick="openModal('health-current')">Подробный расчет</button>
                    </td>
                    <td>
                        <div class="probability-value good-value" id="it-health">38.64%</div>
                        <button class="details-btn" onclick="openModal('health-it')">Подробный расчет</button>
                    </td>
                </tr>
                <tr>
                    <td><strong>Счастье</strong><br>Вероятность быть счастливой</td>
                    <td>
                        <div class="probability-value bad-value" id="current-happy">29.32%</div>
                        <button class="details-btn" onclick="openModal('happy-current')">Подробный расчет</button>
                    </td>
                    <td>
                        <div class="probability-value good-value" id="it-happy">86.5%</div>
                        <button class="details-btn" onclick="openModal('happy-it')">Подробный расчет</button>
                    </td>
                </tr>
                <tr>
                    <td><strong>Полный успех</strong><br>Вероятность быть здоровой, богатой и счастливой</td>
                    <td>
                        <div class="probability-value bad-value" id="current-success">0%</div>
                        <button class="details-btn" onclick="openModal('success-current')">Подробный расчет</button>
                    </td>
                    <td>
                        <div class="probability-value good-value" id="it-success">28.64%</div>
                        <button class="details-btn" onclick="openModal('success-it')">Подробный расчет</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Кнопка палитры и цветовые опции -->
    <div class="theme-palette">
        <button class="palette-button" onclick="toggleColorOptions()">🎨</button>
        <div class="color-options" id="colorOptions">
            <div class="color-option" style="background: #8e83f2;" onclick="applyTheme('theme-dark')"></div>
            <div class="color-option" style="background: #5db5f6;" onclick="applyTheme('theme-blue')"></div>
            <div class="color-option" style="background: #f0503f;" onclick="applyTheme('theme-red')"></div>
            <div class="color-option" style="background: #ffd700;" onclick="applyTheme('theme-yellow')"></div>
            <div class="color-option" style="background: #28a745;" onclick="applyTheme('theme-green')"></div>
            <div class="color-option" style="background: #ffffff;" onclick="openColorCustomizer()">✏️</div>
        </div>
    </div>

    <!-- Кастомизатор цветов -->
    <div class="color-customizer" id="colorCustomizer">
        <div class="color-customizer-content">
            <div class="color-customizer-header">
                <h3 class="color-customizer-title">Настройка цветов</h3>
                <span class="color-customizer-close" onclick="closeColorCustomizer()">&times;</span>
            </div>

            <div class="color-picker-group">
                <label class="color-picker-label">Основной цвет:</label>
                <input type="color" class="color-picker" id="primaryColor" value="#8e83f2">
            </div>

            <div class="color-picker-group">
                <label class="color-picker-label">Акцентный цвет:</label>
                <input type="color" class="color-picker" id="accentColor" value="#c33eeb">
            </div>

            <div class="color-picker-group">
                <label class="color-picker-label">Фон:</label>
                <input type="color" class="color-picker" id="bgColor" value="#010109">
            </div>

            <div class="color-picker-group">
                <label class="color-picker-label">Текст:</label>
                <input type="color" class="color-picker" id="textColor" value="#e4e3fc">
            </div>

            <div class="color-picker-group">
                <label class="color-picker-label">Карточки:</label>
                <input type="color" class="color-picker" id="cardColor" value="#121222">
            </div>

            <div class="color-picker-group">
                <label class="color-picker-label">Цвет неудач:</label>
                <input type="color" class="color-picker" id="badColor" value="#ff6b8b">
            </div>

            <div class="color-picker-group">
                <label class="color-picker-label">Цвет успеха:</label>
                <input type="color" class="color-picker" id="goodColor" value="#6ddea7">
            </div>

            <div class="customizer-buttons">
                <button class="customizer-btn cancel-btn" onclick="closeColorCustomizer()">Отмена</button>
                <button class="customizer-btn apply-btn" onclick="applyCustomTheme()">Применить</button>
            </div>
        </div>
    </div>
    <!-- Модальное окно с параметрами -->
    <div id="parameters-modal" class="modal">
        <div class="modal-content">
            <!-- <div class="modal-header">
                <h3 class="modal-title">Параметры моделирования</h3>
                <span class="close" onclick="closeModal('parameters-modal')">&times;</span>
            </div> -->
            <div class="parameter-controls">

                <div class="parameter-group">
                    <div class="parameter-row">
                        <div class="parameter-label">Период моделирования (лет):</div>
                        <div class="parameter-value">
                            <input type="number" id="years" value="15" min="1" max="50">
                        </div>
                    </div>
                </div>

                <div class="parameter-group">
                    <div class="parameter-row">
                        <div class="parameter-label">Сфера деятельности:</div>
                        <div class="parameter-value">
                            <select id="current-job-type">
                                <option value="office">Офисная работа (администратор, менеджер)</option>
                                <option value="physical">Физический труд (строитель, грузчик)</option>
                                <option value="creative">Творческая работа (дизайнер, писатель)</option>
                                <option value="it">IT-сфера (разработчик, тестировщик)</option>
                                <option value="medical">Медицина (врач, медсестра)</option>
                                <option value="education" selected>Образование (учитель, преподаватель)</option>
                                <option value="sales">Продажи (менеджер по продажам)</option>
                                <option value="service">Сфера услуг (парикмахер, косметолог)</option>
                                <option value="finance">Финансы (бухгалтер, аналитик)</option>
                                <option value="freelance">Фриланс (разные проекты)</option>
                                <option value="unemployed">Безработный</option>
                            </select>
                        </div>
                    </div>
                    <div class="parameter-row">
                        <div class="parameter-label">Доход (₽/мес):</div>
                        <div class="parameter-value">
                            <input type="number" id="current-income" value="35000" min="0">
                        </div>
                    </div>
                    <div class="parameter-row">
                        <div class="parameter-label">Расходы (₽/мес):</div>
                        <div class="parameter-value">
                            <input type="number" id="current-expenses" value="32500" min="0">
                        </div>
                    </div>
                    <div class="parameter-row">
                        <div class="parameter-label">Накопления (₽):</div>
                        <div class="parameter-value">
                            <input type="number" id="current-savings" value="0" min="0">
                        </div>
                    </div>
                    <div class="parameter-row">
                        <div class="parameter-label">Доходность инвестиций (% годовых):</div>
                        <div class="parameter-value">
                            <input type="number" id="current-investment" value="10" step="0.1" min="0" max="10"
                                readonly>
                        </div>
                    </div>
                    <div class="parameter-row">
                        <div class="parameter-label">Количество детей:</div>
                        <div class="parameter-value">
                            <select id="current-children">
                                <option value="0">Нет детей</option>
                                <option value="1">1 ребенок</option>
                                <option value="2">2 ребенка</option>
                                <option value="3">3 и более детей</option>
                            </select>
                        </div>
                    </div>
                    <div class="parameter-row">
                        <div class="parameter-label">Отношения:</div>
                        <div class="parameter-value">
                            <select id="current-relationship-status">
                                <option value="0" selected>Не в отношениях</option>
                                <option value="7">В отношениях</option>
                            </select>
                        </div>
                    </div>
                    <div class="parameter-row">
                        <div class="parameter-label">Удовлетворённость отношениями (1-10):</div>
                        <div class="parameter-value">
                            <input type="number" id="current-relationship" value="5" min="1" max="10">
                        </div>
                    </div>
                    <div class="parameter-row">
                        <div class="parameter-label">Уровень стресса (1-10):</div>
                        <div class="parameter-value">
                            <input type="number" id="current-stress" value="5" min="1" max="10">
                        </div>
                    </div>
                    <div class="parameter-row">
                        <div class="parameter-label">Качество сна (1-10):</div>
                        <div class="parameter-value">
                            <input type="number" id="current-sleep" value="5" min="1" max="10">
                        </div>
                    </div>
                    <div class="parameter-row">
                        <div class="parameter-label">Физическая активность (часов/неделю):</div>
                        <div class="parameter-value">
                            <input type="number" id="current-activity" value="3" min="0" max="40">
                        </div>
                    </div>
                    <div class="parameter-row">
                        <div class="parameter-label">Вредные привычки:</div>
                        <div class="parameter-value">
                            <select id="current-bad-habits">
                                <option value="0">Нет</option>
                                <option value="1">Курение</option>
                                <option value="2">Алкоголь</option>
                                <option value="3">Другое</option>
                            </select>
                        </div>
                    </div>
                    <div class="parameter-row">
                        <div class="parameter-label">Удовлетворённость работой (1-10):</div>
                        <div class="parameter-value">
                            <input type="number" id="current-job-satisfaction" value="3" min="1" max="10">
                        </div>
                    </div>
                </div>

                <button class="update-btn" onclick="updateCalculations(); closeModal('parameters-modal')">Обновить
                    расчёты</button>
            </div>
        </div>
    </div>

    <!-- Модальные окна с расчетами -->
    <div id="money-current" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Финансы: Твоя жизнь сейчас</h3>
                <span class="close" onclick="closeModal('money-current')">&times;</span>
            </div>
            <div class="calculation-steps" id="money-current-calculation">
                <!-- Content will be generated dynamically -->
            </div>
        </div>
    </div>

    <div id="money-it" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Финансы: Фронтенд-разработчик</h3>
                <span class="close" onclick="closeModal('money-it')">&times;</span>
            </div>
            <div class="calculation-steps" id="money-it-calculation">
                <!-- Content will be generated dynamically -->
            </div>
        </div>
    </div>

    <div id="health-current" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Здоровье: Твоя жизнь сейчас</h3>
                <span class="close" onclick="closeModal('health-current')">&times;</span>
            </div>
            <div class="calculation-steps" id="health-current-calculation">
                <!-- Content will be generated dynamically -->
            </div>
        </div>
    </div>

    <div id="health-it" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Здоровье: Фронтенд-разработчик</h3>
                <span class="close" onclick="closeModal('health-it')">&times;</span>
            </div>
            <div class="calculation-steps" id="health-it-calculation">
                <!-- Content will be generated dynamically -->
            </div>
        </div>
    </div>

    <div id="happy-current" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Счастье: Твоя жизнь сейчас</h3>
                <span class="close" onclick="closeModal('happy-current')">&times;</span>
            </div>
            <div class="calculation-steps" id="happy-current-calculation">
                <!-- Content will be generated dynamically -->
            </div>
        </div>
    </div>

    <div id="happy-it" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Счастье: Фронтенд-разработчик</h3>
                <span class="close" onclick="closeModal('happy-it')">&times;</span>
            </div>
            <div class="calculation-steps" id="happy-it-calculation">
                <!-- Content will be generated dynamically -->
            </div>
        </div>
    </div>

    <div id="success-current" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Полный успех: Твоя жизнь сейчас</h3>
                <span class="close" onclick="closeModal('success-current')">&times;</span>
            </div>
            <div class="calculation-steps" id="success-current-calculation">
                <!-- Content will be generated dynamically -->
            </div>
        </div>
    </div>

    <div id="success-it" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Полный успех: Фронтенд-разработчик</h3>
                <span class="close" onclick="closeModal('success-it')">&times;</span>
            </div>
            <div class="calculation-steps" id="success-it-calculation">
                <!-- Content will be generated dynamically -->
            </div>
        </div>
    </div>

    <script>
        // Управление модальными окнами
        function openModal(id) {
            document.getElementById(id).style.display = 'block';
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        // Закрытие при клике вне окна
        window.onclick = function (event) {
            if (event.target.className === 'modal') {
                event.target.style.display = 'none';
            }
        }

        // Форматирование чисел
        function formatPercent(value) {
            if (value < 0.0001) {
                // Для очень малых чисел форматируем вручную
                const fixedValue = value.toFixed(8); // Фиксируем 8 знаков после запятой
                return parseFloat(fixedValue).toString() + '%'; // Убираем лишние нули
            } else if (value < 1) {
                return value.toFixed(4) + '%'; // 4 знака для малых процентов
            } else {
                return value.toFixed(2) + '%'; // 2 знака для обычных значений
            }
        }

        function formatMoney(value) {
            return '$' + value.toLocaleString('en-US', { maximumFractionDigits: 0 });
        }

        // Исправленная логика для отношений
        document.getElementById('current-relationship-status').addEventListener('change', function () {
            const relationshipInput = document.getElementById('current-relationship');
            if (this.value === '0') {
                relationshipInput.disabled = true;
                relationshipInput.value = '1';
            } else {
                relationshipInput.disabled = false;
                relationshipInput.value = this.value;
            }
        });

        // Основные расчеты
        function calculateCurrentMoney() {
            const income = parseFloat(document.getElementById('current-income').value);
            const expenses = parseFloat(document.getElementById('current-expenses').value);
            const savings = parseFloat(document.getElementById('current-savings').value);
            const investmentReturn = 0.10; // Фиксированные 10%
            const years = parseFloat(document.getElementById('years').value);
            const children = parseInt(document.getElementById('current-children').value);

            // Новый расчет влияния детей на расходы (15% на ребенка)
            const childrenFactor = 1 + (children * 0.15);
            const adjustedExpenses = expenses * childrenFactor;

            const savingsPerMonth = income - adjustedExpenses;
            const savingsPerYear = savingsPerMonth * 12 / 73; // Конвертация RUB в USD

            if (savingsPerYear <= 0) return 0;

            // Расчет будущей стоимости
            const futureValue = savings / 73 + savingsPerYear * ((Math.pow(1 + investmentReturn, years) - 1) / investmentReturn);

            // Расчет вероятности достижения $1M
            let probability;
            if (futureValue >= 1000000) {
                probability = 100;
            } else if (futureValue >= 500000) {
                probability = (futureValue / 1000000) * 50; // До 50% при $500K–$1M
            } else {
                probability = (futureValue / 1000000) * 10; // < 5% для сумм < $500K
            }
            probability = Math.min(100, probability.toFixed(2));

            // Generate calculation steps for modal
            let calculationHTML = `
                <div class="calculation-step">

                    <ul>
                        <li>Доход: ${income.toLocaleString('ru-RU')} ₽/мес ($${(income / 73).toFixed(0)})</li>
                        <li>Расходы: ${expenses.toLocaleString('ru-RU')} ₽/мес (базовые)</li>
                        <li>Количество детей: ${children} (${children > 0 ? 'увеличивает расходы на ' + (children * 30) + '%' : 'не влияет на расходы'})</li>
                        <li>Скорректированные расходы: ${adjustedExpenses.toLocaleString('ru-RU')} ₽/мес ($${(adjustedExpenses / 73).toFixed(0)})</li>
                        <li>Сбережения: ${savings.toLocaleString('ru-RU')} ₽ ($${(savings / 73).toFixed(0)})</li>
                        <li>Сбережения в месяц: ${savingsPerMonth.toLocaleString('ru-RU')} ₽ ($${(savingsPerMonth / 73).toFixed(0)})</li>
                        <li>Период: ${years} лет</li>
                        <li>Доходность инвестиций: ${(investmentReturn * 100).toFixed(1)}% годовых</li>
                    </ul>
                </div>
                
                <div class="calculation-step">
                    <h4>Расчёт:</h4>
                    <div class="calculation-formula">
                        Годовые сбережения: $${(savingsPerMonth / 73).toFixed(0)} × 12 = $${savingsPerYear.toFixed(0)}<br><br>
                        
                        Будущая стоимость:<br>
                        FV = Накопления + Аннуитет<br>
                        = $${(savings / 73).toFixed(0)} + $${savingsPerYear.toFixed(0)} × [(1+${investmentReturn.toFixed(4)})^${years} - 1)/${investmentReturn.toFixed(4)}]<br>
                        ≈ ${formatMoney(futureValue)}
                    </div>
                </div>
                
                <div class="calculation-step">
                    <h4>Вероятность достижения цели:</h4>
                    <div class="calculation-formula">
                        P(накопить $1M) = ${probability.toFixed(1)}%
                    </div>
                    <p>Вывод: ${probability >= 50 ? 'умеренная' : 'низкая'} вероятность достичь цели $1 млн при текущих условиях.</p>
                    ${children > 0 ? '<p>Наличие детей значительно снижает возможность накоплений.</p>' : ''}
                </div>
            `;

            document.getElementById('money-current-calculation').innerHTML = calculationHTML;

            return probability;
        }

        function calculateITMoney() {
            // Fixed parameters for IT scenario
            const income = 225000;
            const expenses = 50000;
            const investmentReturn = 0.10; // 10% по умолчанию для IT
            const careerGrowthProb = 0.60;
            const jobLossRisk = 0.10;
            const years = parseFloat(document.getElementById('years').value);

            const savingsPerMonth = income - expenses;
            const savingsPerYear = savingsPerMonth * 12 / 73; // Convert RUB to USD (approximate)

            // Base calculation without career growth
            let futureValue = savingsPerYear * (Math.pow(1 + investmentReturn, years) - 1) / investmentReturn;

            // Adjust for career growth (50% increase after 5 years with 60% probability)
            const growthFactor = Math.pow(1.5, careerGrowthProb);
            futureValue *= growthFactor;

            // Adjust for job loss risk
            futureValue *= (1 - jobLossRisk);

            // Calculate probability to reach $1M
            let probability = 0;
            if (futureValue >= 1000000) {
                probability = 100;
            } else if (futureValue >= 800000) {
                probability = 80 + (futureValue - 800000) / 10000;
            } else if (futureValue >= 500000) {
                probability = 50 + (futureValue - 500000) / 10000;
            } else {
                probability = futureValue / 10000;
            }

            probability = Math.min(100, probability);

            // Generate calculation steps for modal
            let calculationHTML = `
                <div class="calculation-step">

                    <ul>
                        <li>Доход: ${income.toLocaleString('ru-RU')} ₽/мес ($${(income / 73).toFixed(0)}) (мидл-позиция + вторая работа)</li>
                        <li>Расходы: ${expenses.toLocaleString('ru-RU')} ₽/мес ($${(expenses / 73).toFixed(0)})</li>
                        <li>Сбережения: ${savingsPerMonth.toLocaleString('ru-RU')} ₽/мес ($${(savingsPerMonth / 73).toFixed(0)})</li>
                        <li>Период: ${years} лет</li>
                        <li>Доходность инвестиций: ${(investmentReturn * 100).toFixed(1)}% годовых</li>
                        <li>Карьерный рост: +50% дохода через 5 лет (вероятность ${(careerGrowthProb * 100).toFixed(1)}%)</li>
                        <li>Риск потери работы: ${(jobLossRisk * 100).toFixed(1)}% за ${years} лет</li>
                    </ul>
                </div>
                
                <div class="calculation-step">
                    <h4>Базовый расчёт:</h4>
                    <div class="calculation-formula">
                        Годовые сбережения: $${(savingsPerMonth / 73).toFixed(0)} × 12 = $${savingsPerYear.toFixed(0)}<br><br>
                        
                        Будущая стоимость аннуитета:<br>
                        FV = ${savingsPerYear.toFixed(0)} × [(1+${investmentReturn.toFixed(4)})^${years} - 1)/${investmentReturn.toFixed(4)}] ≈ ${formatMoney(savingsPerYear * (Math.pow(1 + investmentReturn, years) - 1) / investmentReturn)}
                    </div>
                </div>
                
                <div class="calculation-step">
                    <h4>С учётом факторов:</h4>
                    <div class="calculation-formula">
                        Скорректированная сумма:<br>
                        ${formatMoney(savingsPerYear * (Math.pow(1 + investmentReturn, years) - 1) / investmentReturn)} × ${growthFactor.toFixed(2)} × ${(1 - jobLossRisk).toFixed(2)} ≈ ${formatMoney(futureValue)}<br>
                        (карьерный рост × риск потери работы)
                    </div>
                </div>
                
                <div class="calculation-step">
                    <h4>Вероятность достижения цели:</h4>
                    <div class="calculation-formula">
                        P(накопить $1M) = ${probability.toFixed(1)}%
                    </div>
                    <p>Вывод: высокая вероятность достичь цели $1 млн благодаря масштабируемому доходу и контролю над расходами.</p>
                </div>
            `;

            document.getElementById('money-it-calculation').innerHTML = calculationHTML;

            return probability;
        }

        function calculateCurrentHealth() {
            const stressLevel = parseFloat(document.getElementById('current-stress').value) / 10;
            const sleepQuality = parseFloat(document.getElementById('current-sleep').value) / 10;
            const activityHours = parseFloat(document.getElementById('current-activity').value);
            const children = parseInt(document.getElementById('current-children').value);
            const years = parseFloat(document.getElementById('years').value);
            const jobType = document.getElementById('current-job-type').value;
            const badHabits = document.getElementById('current-bad-habits').value;

            // Base illness rate based on stress and sleep
            let illnessesPerYear = 3 + (1 - sleepQuality) * 5 + stressLevel * 4;

            // Adjust for children
            illnessesPerYear += children * 2;

            // Adjust for job type
            switch (jobType) {
                case 'office':
                    illnessesPerYear += 2; // Сидячая работа
                    break;
                case 'physical':
                    illnessesPerYear += 4; // Физический труд - высокий риск травм
                    break;
                case 'creative':
                    illnessesPerYear += 1; // Творческая работа - средний стресс
                    break;
                case 'it':
                    illnessesPerYear += 1; // IT - сидячая, но гибкие условия
                    break;
                case 'medical':
                    illnessesPerYear += 5; // Медицина - высокий стресс и инфекции
                    break;
                case 'education':
                    illnessesPerYear += 3; // Образование - стресс + контакты с людьми
                    break;
                case 'sales':
                    illnessesPerYear += 2; // Продажи - средний стресс
                    break;
                case 'service':
                    illnessesPerYear += 2; // Сфера услуг - физическая активность
                    break;
                case 'finance':
                    illnessesPerYear += 3; // Финансы - высокий стресс
                    break;
                case 'freelance':
                    illnessesPerYear += 2; // Фриланс - нестабильность
                    break;
                case 'unemployed':
                    illnessesPerYear += 4; // Безработица - стресс + возможно плохие условия
                    break;
                default:
                    illnessesPerYear += 1;
            }

            // Adjust for bad habits
            if (badHabits !== '0') {
                illnessesPerYear += 3;
            }

            // Fixed complication risk (5%)
            const complicationRisk = 0.05;
            const totalIllnesses = illnessesPerYear * years;
            const pNoComplications = Math.pow(1 - complicationRisk, totalIllnesses);

            // Calculate health factors
            const stressImpact = stressLevel * 0.4;
            const sleepImpact = (1 - sleepQuality) * 0.3;
            const activityImpact = (1 - Math.min(1, activityHours / 10)) * 0.2;
            const childrenImpact = children > 0 ? 0.1 : 0;
            const jobImpact = jobType === 'office' || jobType === 'it' ? 0.1 : 0.15;
            const habitsImpact = badHabits !== '0' ? 0.15 : 0;

            const totalRisk = stressImpact + sleepImpact + activityImpact + childrenImpact + jobImpact + habitsImpact;
            const pNoLifestyleIssues = 1 - totalRisk;

            // Final probability
            const pHealth = pNoComplications * pNoLifestyleIssues;

            // Generate calculation steps for modal
            let calculationHTML = `
                <div class="calculation-step">
                    <ul>
                        <li>Уровень стресса: ${stressLevel * 10}/10</li>
                        <li>Качество сна: ${sleepQuality * 10}/10</li>
                        <li>Физическая активность: ${activityHours} часов/неделю</li>
                        <li>Количество детей: ${children}</li>
                        <li>Сфера деятельности: ${document.getElementById('current-job-type').options[document.getElementById('current-job-type').selectedIndex].text}</li>
                        <li>Вредные привычки: ${badHabits !== '0' ? 'Да' : 'Нет'}</li>
                        <li>Период: ${years} лет</li>
                    </ul>
                </div>
                
                <div class="calculation-step">
                    <h4>Расчёт количества болезней:</h4>
                    <div class="calculation-formula">
                        Базовый уровень: 3 болезни/год 
                        + ${((1 - sleepQuality) * 5).toFixed(1)} из-за плохого сна
                        + ${(stressLevel * 4).toFixed(1)} из-за стресса
                        + ${(children * 2).toFixed(1)} из-за детей
                        + ${jobType === 'office' ? 2 : jobType === 'physical' ? 3 : jobType === 'medical' ? 4 : jobType === 'it' ? 1 : 1} из-за работы
                        ${badHabits !== '0' ? '+ 3 из-за вредных привычек' : ''}
                        = ${illnessesPerYear.toFixed(1)} болезней/год<br>
                        
                        Всего болезней за ${years} лет: ${illnessesPerYear.toFixed(1)} × ${years} ≈ ${totalIllnesses.toFixed(0)}
                    </div>
                </div>
                
                <div class="calculation-step">
                    <h4>Расчёт вероятности избежать осложнений:</h4>
                    <div class="calculation-formula">
                        Риск осложнений: 5% на болезнь<br>
                        P(без осложнений) = 0.95^${totalIllnesses.toFixed(0)} ≈ ${pNoComplications.toFixed(4)} (${(pNoComplications * 100).toFixed(2)}%)
                    </div>
                </div>
                
                <div class="calculation-step">
                    <h4>Расчёт факторов образа жизни:</h4>
                    <div class="calculation-formula">
                        Влияние стресса: ${(stressLevel * 100).toFixed(1)}% × 40% = ${(stressImpact * 100).toFixed(1)}%<br>
                        Влияние плохого сна: ${((1 - sleepQuality) * 100).toFixed(1)}% × 30% = ${(sleepImpact * 100).toFixed(1)}%<br>
                        Влияние низкой активности: ${((1 - Math.min(1, activityHours / 10)) * 100).toFixed(1)}% × 20% = ${(activityImpact * 100).toFixed(1)}%<br>
                        Влияние детей: ${(childrenImpact * 100).toFixed(1)}%<br>
                        Влияние работы: ${(jobImpact * 100).toFixed(1)}%<br>
                        ${badHabits !== '0' ? 'Влияние вредных привычек: ' + (habitsImpact * 100).toFixed(1) + '%<br>' : ''}
                        
                        Общий риск от образа жизни: ${(totalRisk * 100).toFixed(1)}%<br>
                        P(здорового образа жизни) = 1 - ${totalRisk.toFixed(4)} = ${pNoLifestyleIssues.toFixed(4)} (${(pNoLifestyleIssues * 100).toFixed(2)}%)
                    </div>
                </div>
                
                <div class="calculation-step">
                    <h4>Итоговый расчёт:</h4>
                    <div class="calculation-formula">
                        P(здоровья) = P(без осложнений) × P(здорового образа жизни)<br>
                        = ${pNoComplications.toFixed(4)} × ${pNoLifestyleIssues.toFixed(4)} ≈ ${pHealth.toFixed(4)} (${(pHealth * 100).toFixed(2)}%)
                    </div>
                    <p>Вывод: ${pHealth >= 0.5 ? 'умеренная' : 'низкая'} вероятность сохранить здоровье при текущем образе жизни.</p>
                    ${children > 0 ? '<p>Наличие детей увеличивает нагрузку на здоровье.</p>' : ''}
                    ${badHabits !== '0' ? '<p>Вредные привычки значительно снижают вероятность сохранения здоровья.</p>' : ''}
                </div>
            `;

            document.getElementById('health-current-calculation').innerHTML = calculationHTML;

            return pHealth * 100;
        }

        function calculateITHealth() {
            const years = parseFloat(document.getElementById('years').value);

            // Исходные данные
            const totalIllnesses = 3 * years; // Болезни за годы
            const complicationRiskPerIllness = 0.98; // 2% риск осложнений на болезнь
            const burnoutRiskReduction = 1.20; // Баланс работы/отдыха уменьшает риск на 20%
            const baseBurnoutRisk = 0.80; // Базовая вероятность избежать выгорания

            // Расчет вероятности избежать осложнений
            const healthWithoutComplications = Math.pow(complicationRiskPerIllness, totalIllnesses);

            // Расчет вероятности избежать выгорания
            const healthWithoutBurnout = baseBurnoutRisk * burnoutRiskReduction;

            // Итоговая вероятность здоровья
            const finalHealth = healthWithoutComplications * healthWithoutBurnout;

            // Генерация HTML с расчетами
            const calculationHTML = `
        <div class="calculation-step">
            Риски:<br>
            - Сидячая работа: +30% к хроническим болезням (уменьшено до 10% за счет активности)<br>
            - Стресс от переработок: 40% риск выгорания (уменьшено до 20% за счет удаленной работы и ПП)<br>
            - Баланс работы/отдыха: -20% к рискам (осознанный подход)<br><br>
            
            Болезни/год: 3 (с учетом активности и ПП)<br>
            Осложнения: 2% на болезнь<br><br>
            
            <strong>Расчёт:</strong><br>
            1. Осложнения за ${years} лет:<br>
            <div class="calculation-formula">
                P(здоровья) = 0.98^${totalIllnesses} ≈ ${healthWithoutComplications.toFixed(4)} (${(healthWithoutComplications * 100).toFixed(2)}%)<br>
            </div>
            2. Стресс:<br>
            <div class="calculation-formula">
                P(без выгорания) = 0.80 × 1.20 = ${healthWithoutBurnout.toFixed(2)} (${(healthWithoutBurnout * 100).toFixed(2)}%)<br>
            </div>
            3. Итог:<br>
            <div class="calculation-formula">
                ${healthWithoutComplications.toFixed(4)} × ${healthWithoutBurnout.toFixed(2)} ≈ ${finalHealth.toFixed(4)} (${(finalHealth * 100).toFixed(2)}%)<br>
                P(здоровья) = ${(finalHealth * 100).toFixed(2)}%
            </div>
        </div>
    `;

            document.getElementById('health-it-calculation').innerHTML = calculationHTML;

            // Возвращаем итоговую вероятность здоровья
            return finalHealth * 100; // Итоговая вероятность в процентах
        }


        function calculateCurrentHappiness() {
            const jobSatisfaction = parseFloat(document.getElementById('current-job-satisfaction').value) / 10;
            const relationshipStatus = document.getElementById('current-relationship-status').value;
            let relationship = relationshipStatus === '0' ? 0 : parseFloat(document.getElementById('current-relationship').value) / 10;
            const stressLevel = parseFloat(document.getElementById('current-stress').value) / 10;
            const children = parseInt(document.getElementById('current-children').value);
            const financialStability = parseFloat(document.getElementById('current-income').value) / parseFloat(document.getElementById('current-expenses').value);

            // Calculate happiness based on factors with weights
            const weights = {
                job: 0.3,
                relationship: relationshipStatus === '0' ? 0 : 0.3,
                stress: 0.2,
                children: children > 0 ? 0.1 : 0,
                finances: 0.1,
                freedom: relationshipStatus === '0' ? 0.1 : 0 // Дополнительная свобода, если не в отношениях
            };

            // Adjust relationship satisfaction based on stress
            const adjustedRelationship = relationship * (1 - stressLevel * 0.3);

            // Normalize factors
            const jobFactor = jobSatisfaction;
            const relationshipFactor = adjustedRelationship;
            const stressFactor = 1 - stressLevel;
            const childrenFactor = children > 0 ? 0.7 : 1; // Children reduce happiness by 30%
            const financesFactor = Math.min(1, financialStability / 1.5);
            const freedomFactor = relationshipStatus === '0' ? 0.8 : 0.2; // Больше свободы, если не в отношениях

            // Calculate weighted happiness
            let pHappy = jobFactor * weights.job +
                relationshipFactor * weights.relationship +
                stressFactor * weights.stress +
                childrenFactor * (children > 0 ? weights.children : 0) +
                financesFactor * weights.finances +
                freedomFactor * weights.freedom;

            // Normalize to account for possible weight variations
            const totalWeight = weights.job + weights.relationship + weights.stress +
                (children > 0 ? weights.children : 0) + weights.finances + weights.freedom;
            pHappy /= totalWeight;

            // Generate calculation steps for modal
            let calculationHTML = `
                <div class="calculation-step">
                    <ul>
                        <li>Удовлетворённость работой: ${jobSatisfaction * 10}/10</li>
                        <li>${relationshipStatus === '0' ? 'Не в отношениях' : 'Удовлетворённость отношениями: ' + (relationship * 10) + '/10'}</li>
                        <li>Уровень стресса: ${stressLevel * 10}/10</li>
                        <li>Количество детей: ${children}</li>
                        <li>Финансовая стабильность (доход/расход): ${financialStability.toFixed(2)}</li>
                    </ul>
                </div>
                
                <div class="calculation-step">
                    <h4>Расчёт с весовыми коэффициентами:</h4>
                    <div class="calculation-formula">
                        P(счастья) = (Работа × ${(weights.job * 100).toFixed(0)}%) 
                        ${relationshipStatus !== '0' ? '+ (Отношения × ' + (weights.relationship * 100).toFixed(0) + '%)' : ''}
                        + (Отсутствие стресса × ${(weights.stress * 100).toFixed(0)}%) 
                        ${children > 0 ? '+ (Дети × ' + (weights.children * 100).toFixed(0) + '%)' : ''}
                        + (Финансы × ${(weights.finances * 100).toFixed(0)}%)
                        ${relationshipStatus === '0' ? '+ (Свобода × ' + (weights.freedom * 100).toFixed(0) + '%)' : ''}
                        
                        = (${jobFactor.toFixed(2)} × ${weights.job.toFixed(2)}) 
                        ${relationshipStatus !== '0' ? '+ (' + relationshipFactor.toFixed(2) + ' × ' + weights.relationship.toFixed(2) + ')' : ''}
                        + (${stressFactor.toFixed(2)} × ${weights.stress.toFixed(2)}) 
                        ${children > 0 ? '+ (' + childrenFactor.toFixed(2) + ' × ' + weights.children.toFixed(2) + ')' : ''}
                        + (${financesFactor.toFixed(2)} × ${weights.finances.toFixed(2)})
                        ${relationshipStatus === '0' ? '+ (' + freedomFactor.toFixed(2) + ' × ' + weights.freedom.toFixed(2) + ')' : ''}
                        
                        = ${(jobFactor * weights.job).toFixed(2)} 
                        ${relationshipStatus !== '0' ? '+ ' + (relationshipFactor * weights.relationship).toFixed(2) : ''}
                        + ${(stressFactor * weights.stress).toFixed(2)} 
                        ${children > 0 ? '+ ' + (childrenFactor * weights.children).toFixed(2) : ''}
                        + ${(financesFactor * weights.finances).toFixed(2)}
                        ${relationshipStatus === '0' ? '+ ' + (freedomFactor * weights.freedom).toFixed(2) : ''}
                        
                        = ${pHappy.toFixed(4)} (${(pHappy * 100).toFixed(2)}%)
                    </div>
                </div>
                
                <div class="calculation-step">
                    <h4>Вывод:</h4>
                    <p>${pHappy >= 0.7 ? 'Высокая' : pHappy >= 0.5 ? 'Умеренная' : 'Низкая'} вероятность счастья при текущих условиях жизни.</p>
                    ${children > 0 ? '<p>Наличие детей влияет на уровень счастья.</p>' : ''}
                    ${stressLevel > 0.5 ? '<p>Высокий уровень стресса значительно снижает удовлетворённость жизнью.</p>' : ''}
                    ${relationshipStatus === '0' ? '<p>Отсутствие отношений компенсируется большей свободой.</p>' : ''}
                </div>
            `;

            document.getElementById('happy-current-calculation').innerHTML = calculationHTML;

            return pHappy * 100;
        }

        function calculateITHappiness() {
            const years = parseFloat(document.getElementById('years').value);

            // Расчет для IT сценария согласно новым требованиям
            let calculationHTML = `
                <div class="calculation-steps">
                <div class="calculation-step">
                    <table style="width: 100%; margin-bottom: 20px;">
                        <tr>
                            <th>Фактор</th>
                            <th>Риск</th>
                            <th>Вес</th>
                        </tr>
                        <tr>
                            <td>Финансовая нестабильность</td>
                            <td>15%</td>
                            <td>25%</td>
                        </tr>
                        <tr>
                            <td>Гармоничные отношения</td>
                            <td>20%</td>
                            <td>30%</td>
                        </tr>
                        <tr>
                            <td>Самореализация</td>
                            <td>10%</td>
                            <td>20%</td>
                        </tr>
                        <tr>
                            <td>Свобода выбора</td>
                            <td>5%</td>
                            <td>15%</td>
                        </tr>
                        <tr>
                            <td>Социальные связи</td>
                            <td>10%</td>
                            <td>10%</td>
                        </tr>
                    </table>
                </div>
                
                <div class="calculation-step">
                    <h4>Расчёт:</h4>
                    <div class="calculation-formula">
                        Общий риск несчастья = Σ(Риск × Вес)
                        = (0.15×0.25) + (0.2×0.3) + (0.1×0.2) + (0.05×0.15) + (0.1×0.1)<br>
                        = 0.0375 + 0.06 + 0.02 + 0.0075 + 0.01 = 0.135 (13.5%)<br><br>
                        
                        P(happy) = 1 - 0.135 = 0.865 (86.5%)
                    </div>
                </div>
            
                    <p>Вывод: высокая вероятность счастья благодаря контролируемым условиям жизни и работы.</p>
                </div>
            `;

            document.getElementById('happy-it-calculation').innerHTML = calculationHTML;

            // Возвращаем фиксированное значение 85.5% согласно требованиям
            return 86.5;
        }

        function calculateCurrentSuccess() {
            const pMoney = calculateCurrentMoney() / 100;
            const pHealth = calculateCurrentHealth() / 100;
            const pHappy = calculateCurrentHappiness() / 100;

            const pSuccess = pMoney * pHealth * pHappy;

            // Generate calculation steps for modal
            let calculationHTML = `
                <div class="calculation-step">
                    <h4>Итоговая формула:</h4>
                    <div class="calculation-formula">
                        P(успеха) = P(деньги) × P(здоровье) × P(счастье)
                    </div>
                </div>
                
                <div class="calculation-step">
                    <h4>Расчёт:</h4>
                    <div class="calculation-formula">
                        ${(pMoney).toFixed(4)} × ${(pHealth).toFixed(4)} × ${(pHappy).toFixed(4)} ≈ ${pSuccess.toFixed(4)} (${(pSuccess * 100).toFixed(2)}%)
                    </div>
                    <p>Вывод: ${pSuccess >= 0.1 ? 'заметная' : 'небольшая'} вероятность достичь всех трёх целей одновременно при текущих условиях.</p>
                </div>
            `;

            document.getElementById('success-current-calculation').innerHTML = calculationHTML;

            return pSuccess * 100;
        }

        function calculateITSuccess() {
            const pMoney = calculateITMoney() / 100;
            const pHealth = calculateITHealth() / 100;
            const pHappy = calculateITHappiness() / 100;

            const pSuccess = pMoney * pHealth * pHappy;

            // Generate calculation steps for modal
            let calculationHTML = `
                <div class="calculation-step">
                    <h4>Итоговая формула:</h4>
                    <div class="calculation-formula">
                        P(успеха) = P(деньги) × P(здоровье) × P(счастье)
                    </div>
                </div>
                
                <div class="calculation-step">
                    <h4>Расчёт:</h4>
                    <div class="calculation-formula">
                        ${(pMoney).toFixed(4)} × ${(pHealth).toFixed(4)} × ${(pHappy).toFixed(4)} ≈ ${pSuccess.toFixed(4)} (${(pSuccess * 100).toFixed(2)}%)
                    </div>
                    <p>Вывод: значительная вероятность достичь всех трёх целей одновременно — значительно выше, чем в текущем сценарии.</p>
                </div>
            `;

            document.getElementById('success-it-calculation').innerHTML = calculationHTML;

            return pSuccess * 100;
        }

        function updateCalculations() {
            // Calculate and update all values
            const currentMoney = calculateCurrentMoney();
            const itMoney = calculateITMoney();
            const currentHealth = calculateCurrentHealth();
            const itHealth = calculateITHealth();
            const currentHappy = calculateCurrentHappiness();
            const itHappy = calculateITHappiness();
            const currentSuccess = calculateCurrentSuccess();
            const itSuccess = calculateITSuccess();

            // Update table values
            document.getElementById('current-money').textContent = formatPercent(currentMoney);
            document.getElementById('it-money').textContent = formatPercent(itMoney);
            document.getElementById('current-health').textContent = formatPercent(currentHealth);
            document.getElementById('it-health').textContent = formatPercent(itHealth);
            document.getElementById('current-happy').textContent = formatPercent(currentHappy);
            document.getElementById('it-happy').textContent = formatPercent(itHappy);
            document.getElementById('current-success').textContent = formatPercent(currentSuccess);
            document.getElementById('it-success').textContent = formatPercent(itSuccess);

            // Update color classes based on values
            updateValueClass('current-money', currentMoney);
            updateValueClass('it-money', itMoney);
            updateValueClass('current-health', currentHealth);
            updateValueClass('it-health', itHealth);
            updateValueClass('current-happy', currentHappy);
            updateValueClass('it-happy', itHappy);
            updateValueClass('current-success', currentSuccess);
            updateValueClass('it-success', itSuccess);
        }

        function updateValueClass(elementId, value) {
            const element = document.getElementById(elementId);
            element.classList.remove('bad-value', 'good-value');

            if (value < 30) {
                element.classList.add('bad-value');
            } else {
                element.classList.add('good-value');
            }
        }

        // Initialize calculations on page load
        window.onload = function () {
            updateCalculations();

            // Disable relationship satisfaction if not in relationship
            const relationshipStatus = document.getElementById('current-relationship-status');
            const relationshipInput = document.getElementById('current-relationship');
            if (relationshipStatus.value === '0') {
                relationshipInput.disabled = true;
                relationshipInput.value = '1';
            }

            relationshipStatus.addEventListener('change', function () {
                if (this.value === '0') {
                    relationshipInput.disabled = true;
                    relationshipInput.value = '1';
                } else {
                    relationshipInput.disabled = false;
                    relationshipInput.value = this.value;
                }
            });
        };

        // Переключение палитры
        function toggleColorOptions() {
            const colorOptions = document.getElementById('colorOptions');
            colorOptions.classList.toggle('show');
        }

        // Функция для обновления цвета кнопки палитры
        function updatePaletteButton() {
            const paletteButton = document.querySelector('.palette-button');
            const primaryColor = getComputedStyle(document.documentElement).getPropertyValue('--primary').trim();
            const accentColor = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim();

            paletteButton.style.background = `linear-gradient(45deg, ${primaryColor}, ${accentColor})`;
        }

        // Применение предустановленной темы
        function applyTheme(theme) {
            // Сбрасываем inline стили перед применением темы
            document.documentElement.removeAttribute('style');
            document.documentElement.className = theme;
            localStorage.setItem('selectedTheme', theme);
            updatePaletteButton();

            // Если применяем не кастомную тему, очищаем кастомные настройки
            if (theme !== 'custom') {
                localStorage.removeItem('customTheme');
            }
        }

        // Открытие кастомизатора цветов
        function openColorCustomizer() {
            // Получаем текущие значения CSS-переменных
            const root = document.documentElement;
            const currentPrimary = getComputedStyle(root).getPropertyValue('--primary').trim();
            const currentAccent = getComputedStyle(root).getPropertyValue('--accent').trim();
            const currentBg = getComputedStyle(root).getPropertyValue('--background').trim();
            const currentText = getComputedStyle(root).getPropertyValue('--text').trim();
            const currentCard = getComputedStyle(root).getPropertyValue('--card-bg').trim();
            const currentBad = getComputedStyle(root).getPropertyValue('--bad-value').trim();
            const currentGood = getComputedStyle(root).getPropertyValue('--good-value').trim();

            // Устанавливаем текущие значения в инпуты
            document.getElementById('primaryColor').value = rgbToHex(currentPrimary);
            document.getElementById('accentColor').value = rgbToHex(currentAccent);
            document.getElementById('bgColor').value = rgbToHex(currentBg);
            document.getElementById('textColor').value = rgbToHex(currentText);
            document.getElementById('cardColor').value = rgbToHex(currentCard);
            document.getElementById('badColor').value = rgbToHex(currentBad);
            document.getElementById('goodColor').value = rgbToHex(currentGood);

            // Показываем кастомизатор
            document.getElementById('colorCustomizer').style.display = 'block';
            toggleColorOptions();
        }

        function rgbToHex(rgb) {
            // Если значение уже в HEX формате, возвращаем как есть
            if (rgb.startsWith('#')) return rgb;

            // Обработка RGB/RGBA значений
            const sep = rgb.indexOf(",") > -1 ? "," : " ";
            const rgbArray = rgb.substr(4).split(")")[0].split(sep);

            let r = (+rgbArray[0]).toString(16),
                g = (+rgbArray[1]).toString(16),
                b = (+rgbArray[2]).toString(16);

            if (r.length == 1) r = "0" + r;
            if (g.length == 1) g = "0" + g;
            if (b.length == 1) b = "0" + b;

            return "#" + r + g + b;
        }


        // Закрытие кастомизатора цветов
        function closeColorCustomizer() {
            document.getElementById('colorCustomizer').style.display = 'none';
        }

        // Применение пользовательской темы
        function applyCustomColors(primary, accent, bg, text, card, bad, good) {
            const root = document.documentElement;
            root.style.setProperty('--primary', primary);
            root.style.setProperty('--accent', accent);
            root.style.setProperty('--background', bg);
            root.style.setProperty('--text', text);
            root.style.setProperty('--card-bg', card);
            root.style.setProperty('--bad-value', bad);
            root.style.setProperty('--good-value', good);

            // Удаляем классы тем, чтобы применить кастомные цвета
            root.className = '';

            // Принудительное обновление стилей
            document.querySelectorAll('.bad-value, .good-value').forEach(el => {
                el.style.color = 'inherit';
                void el.offsetWidth; // Trigger reflow
                el.style.color = '';
            });

            updatePaletteButton();
            saveCustomTheme(primary, accent, bg, text, card, bad, good);
        }


        // Обработка кликов вне модального окна кастомизатора
        window.addEventListener('click', function (event) {
            const customizer = document.getElementById('colorCustomizer');
            if (event.target === customizer) {
                closeColorCustomizer();
            }
        });
        // Закрытие при клике вне палитры
        document.addEventListener('click', function (event) {
            const palette = document.querySelector('.theme-palette');
            const colorOptions = document.getElementById('colorOptions');
            const paletteButton = document.querySelector('.palette-button');

            // Если клик не по палитре и палитра открыта
            if (!palette.contains(event.target) && colorOptions.classList.contains('show')) {
                colorOptions.classList.remove('show');
            }
        });

        // Сохранение кастомной темы
        function saveCustomTheme(primary, accent, bg, text, card, bad, good) {
            localStorage.setItem('customTheme', JSON.stringify({
                primary,
                accent,
                bg,
                text,
                card,
                bad,
                good
            }));
            localStorage.setItem('selectedTheme', 'custom');
        }

        // Загрузка кастомной темы
        function loadCustomTheme() {
            const customTheme = localStorage.getItem('customTheme');
            if (customTheme) {
                const theme = JSON.parse(customTheme);
                applyCustomColors(
                    theme.primary,
                    theme.accent,
                    theme.bg,
                    theme.text,
                    theme.card,
                    theme.bad || '#ff6b8b',  // Загружаем с fallback
                    theme.good || '#6ddea7'   // Загружаем с fallback
                );
            }
        }

        // Применение кастомных цветов без изменения класса
        function applyCustomTheme() {
            const primaryColor = document.getElementById('primaryColor').value;
            const accentColor = document.getElementById('accentColor').value;
            const bgColor = document.getElementById('bgColor').value;
            const textColor = document.getElementById('textColor').value;
            const cardColor = document.getElementById('cardColor').value;
            const badColor = document.getElementById('badColor').value;
            const goodColor = document.getElementById('goodColor').value;

            applyCustomColors(primaryColor, accentColor, bgColor, textColor, cardColor, badColor, goodColor);
            closeColorCustomizer();
        }

        // Обновленная функция загрузки темы
        window.onload = function () {
            updateCalculations();

            // Загрузка темы
            const savedTheme = localStorage.getItem('selectedTheme');
            if (savedTheme === 'custom') {
                loadCustomTheme();
            } else if (savedTheme) {
                document.documentElement.className = savedTheme;
            } else {
                document.documentElement.className = 'theme-dark'; // тема по умолчанию
            }

            updatePaletteButton();

            // Остальной код инициализации...
            const relationshipStatus = document.getElementById('current-relationship-status');
            const relationshipInput = document.getElementById('current-relationship');
            if (relationshipStatus.value === '0') {
                relationshipInput.disabled = true;
                relationshipInput.value = '1';
            }

            relationshipStatus.addEventListener('change', function () {
                if (this.value === '0') {
                    relationshipInput.disabled = true;
                    relationshipInput.value = '1';
                } else {
                    relationshipInput.disabled = false;
                    relationshipInput.value = this.value;
                }
            });
        };
    </script>
</body>

</html>